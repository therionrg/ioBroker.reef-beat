{
  "version": 3,
  "sources": ["../src/reefBeatApi.ts"],
  "sourcesContent": ["import axios from \"axios\";\nimport json2iob from \"json2iob\";\nimport { IoBrokerHelper } from \"./IoBrokerHelper\";\nimport { IReefBeat } from \"./types\";\n\nexport class ReefBeatApi {\n\tprotected adapter: IReefBeat;\n\tprotected ip: string;\n\tprotected baseUrl: string;\n\tprotected secure: boolean;\n\tprotected localCapabilities: string[];\n\tprotected headers: { [key: string]: string } = {};\n\tprotected json2iob: json2iob;\n\tprotected token!: string;\n\tprotected tokenExpires: number = 0;\n\tprotected helper: IoBrokerHelper;\n\tpublic aquariumSource: string = \"aquarium\";\n\n\tconstructor(ip: string, secure: boolean = false, adapter: IReefBeat, helper: IoBrokerHelper) {\n\t\tthis.ip = ip;\n\t\tthis.secure = secure;\n\t\tthis.baseUrl = (secure ? \"https://\" : \"http://\") + ip;\n\t\tthis.adapter = adapter;\n\t\tthis.json2iob = new json2iob(adapter);\n\t\tthis.localCapabilities = [\"device-info\", \"mode\", \"dashboard\"];\n\t\tthis.helper = helper;\n\t}\n\n\t// GET Request\n\tpublic async httpGetAsync(path: string): Promise<any | null> {\n\t\tconst url = this.baseUrl + \"/\" + path;\n\n\t\ttry {\n\t\t\tthis.adapter.log.info(`GET ${url}`);\n\n\t\t\t// axios verwendet 'data' f\u00FCr den Response-Body\n\t\t\tconst resp = await axios.get(url, { headers: this.headers });\n\t\t\treturn resp.data;\n\t\t} catch (ex: any) {\n\t\t\tconst status = ex.response ? ex.response.status : \"N/A\";\n\t\t\tthis.adapter.log.error(`GET ${path} failed (Status: ${status}): ${ex.message}`);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t// PPOST or PUT request\n\tprotected async httpSendAsync(path: string, payload: any, method: \"POST\" | \"PUT\"): Promise<boolean> {\n\t\tconst url = this.baseUrl + path;\n\t\tthis.adapter.log.debug(\"Calling \" + url);\n\t\ttry {\n\t\t\tthis.adapter.log.debug(`${method} ${url} Payload: ${JSON.stringify(payload)}`);\n\n\t\t\tconst response = await axios({\n\t\t\t\tmethod: method,\n\t\t\t\turl: url,\n\t\t\t\theaders: {\n\t\t\t\t\t...this.headers,\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t\tdata: undefined,\n\t\t\t});\n\n\t\t\tif (response.status === 200) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tconst text = response.statusText;\n\t\t\t\tthis.adapter.log.info(\"Error calling: \" + text);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch (ex: any) {\n\t\t\tconst status = ex.response ? ex.response.status : \"N/A\";\n\t\t\tthis.adapter.log.error(`${method} ${path} failed (Status: ${status}): ${ex.message}`);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprotected async getDataAsync<T = any>(sourceName: string): Promise<T | null> {\n\t\tconst result = await this.httpGetAsync(sourceName);\n\t\tthis.adapter.log.debug(`Data from ${sourceName}: ${JSON.stringify(result)}`);\n\n\t\treturn result;\n\t}\n\n\tprivate async applyFeedMaintMode(baseDataPoint: string): Promise<void> {\n\t\tthis.helper.ensureStateAsync(baseDataPoint + \".feedMode\", \"Feed Mode\", \"boolean\", \"switch\", true, true);\n\t\tthis.helper.ensureStateAsync(baseDataPoint + \".maintMode\", \"Maintenance Mode\", \"boolean\", \"switch\", true, true);\n\t}\n\n\tprotected async getAndSetDataAsync(sourceName: string): Promise<void> {\n\t\tconst result = await this.getDataAsync(sourceName);\n\n\t\tconst count = result?.length ?? 0;\n\n\t\tif (this.constructor.name != \"ReefCloud\") {\n\t\t\tconst prefix = `${this.constructor.name}.${sourceName}`;\n\t\t\tthis.json2iob.parse(prefix, result, { forceIndex: true });\n\t\t\tthis.helper.ensureStateAsync(\n\t\t\t\tthis.constructor.name + \".\" + sourceName + \"._refresh\",\n\t\t\t\t\"Refresh data\",\n\t\t\t\t\"boolean\",\n\t\t\t\t\"button\",\n\t\t\t\ttrue,\n\t\t\t\ttrue,\n\t\t\t);\n\t\t\tif (sourceName === \"aquarium\") this.applyFeedMaintMode(prefix);\n\t\t} else {\n\t\t\tresult.forEach((entry: any, counter: number) => {\n\t\t\t\tconst key = entry.model?.trim() || counter + 1;\n\t\t\t\tconst prefix = `${this.constructor.name}.${sourceName}${count === 1 ? \"\" : \"s.\" + key}`;\n\t\t\t\tthis.json2iob.parse(prefix, entry, { forceIndex: true });\n\t\t\t\tthis.helper.ensureStateAsync(\n\t\t\t\t\tthis.constructor.name + \".\" + sourceName + (count === 1 ? \"\" : \"s\") + \"._refresh\",\n\t\t\t\t\t\"Refresh data\",\n\t\t\t\t\t\"boolean\",\n\t\t\t\t\t\"button\",\n\t\t\t\t\ttrue,\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t\tif (sourceName === \"aquarium\") this.applyFeedMaintMode(prefix);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async pollBasicDataAsync(sourceName?: string): Promise<void> {\n\t\tif (sourceName) {\n\t\t\tawait this.getAndSetDataAsync(sourceName);\n\t\t} else {\n\t\t\tconst requests = this.localCapabilities.map(async (capability) => {\n\t\t\t\tthis.getAndSetDataAsync(capability);\n\t\t\t});\n\n\t\t\tawait Promise.all(requests);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["json2iob", "axios", "_a"]
}
